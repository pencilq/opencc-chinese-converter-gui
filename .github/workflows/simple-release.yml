name: Simple Release Build

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:

jobs:
  build-and-release:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [windows-latest, macos-latest]
        include:
          - os: windows-latest
            platform: windows
            ext: .exe
            separator: ";"
          - os: macos-latest  
            platform: macos
            ext: ""
            separator: ":"
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pyinstaller
    
    - name: Build with PyInstaller
      run: |
        pyinstaller --onefile --noconsole --name "OpenCC中文转换器" opencc-py-gui.py
    
    - name: Upload to Release
      uses: softprops/action-gh-release@v2
      if: startsWith(github.ref, 'refs/tags/')
      with:
        files: |
          dist/OpenCC中文转换器${{ matrix.ext }}
        name: OpenCC 中文转换器 ${{ github.ref_name }}
        body: |
          ## OpenCC 中文转换器 ${{ github.ref_name }}
          
          ### 下载说明
          - Windows 用户: 下载 `OpenCC中文转换器.exe`
          - macOS 用户: 下载 `OpenCC中文转换器` (无扩展名)
          
          ### 主要功能
          - 🔄 简体/繁体中文互转
          - 📊 支持 Excel、Word、文本文件
          - 🎯 Excel 多列选择转换
          - 👀 实时预览转换结果
          
          ### 使用方法
          1. 双击运行程序
          2. 选择文件或直接输入文本
          3. 配置转换设置
          4. 开始转换
        draft: false
        prerelease: false